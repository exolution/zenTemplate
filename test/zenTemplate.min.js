var zenTemplate=function(t,e){function n(t,n){w[t]==e?w[t]=[n]:w[t].unshift(n)}function i(t,n){w[t]==e?w[t]=[n]:w[t].push(n)}function r(t,e){w[t]=[e]}function a(t,e){var n;return w[t]?(n=w[t].indexOf(e),-1!=n?(w[t].splice(n,1),!0):!1):!1}function s(t){var e,n;if(w[t]&&(e=w[t].length)>0)for(var i=0;e>i;i++)n=w[t][i].apply(w[t],Array.prototype.slice.call(arguments,1).concat(n));return n}function o(t,e){var n,i="";if(v=v||/%([0-9]+|[a-zA-Z])%/g,0==e||isNaN(e))return t;var r=function(t,e,i,r){return U&&U.call(r,e,i+1)||isNaN(+e)?String.fromCharCode(e.charCodeAt(0)+n):+e+n+""};for(n=0;e>n;n++)i+=t.replace(v,r);return r=null,i}function l(t){this.type=t||"tag",this.className="",this.props=[]}function u(){switch(y){case T.TAG_NAME:x.tagName=L;break;case T.ID:x.id=L;break;case T.CLASS_NAME:x.className+=L+" ";break;case T.VALUE:x.textContent=L}x.tier=V}function c(t,e){y==T.COMPLETE?+e>0&&(k[k.length-1]+="*"+e):(u(),x.isClosed=t,x.iterNum=+e,k.push(x),x=new l)}function p(t){var e="";for(var n in t)e+=JSON.stringify(t[n])+"\n";console.log(e)}function h(t,e){console.log(arguments);var n,i,r="";for(e=e||0;t.length>0;)if(n=t.pop(),n instanceof l)r=n.toHTML(r),console.log(r);else if("string"==typeof n&&")"==n.charAt(0))i=h(t,+n.split("*")[1]||0),r=i+r;else if("("===n)return e>0?o(r,e):r;return e>0?o(r,e):r}function m(t,e){var n="";if(1===e||-1===e&&!t.isClosed)for(var i=0;t.tier>i;i++)n+="    ";else(-2===e||!t.isClosed&&2===e)&&(n="\n");return n}function d(t){t?r("tagHtmlRim",m):a("tagHtmlRim",m)}function f(t){for(var e,n,i,r,a="",s=0,o=0,l=0,u=!1,c=-1,p=0;t.length>s;)"\n"!=a&&" "!=a&&(e=a),a=t.charAt(s),n=!u&&c!=T.ATTR&&c!=T.VALUE,i=!u&&c!=T.VALUE,r=!u&&c!=T.ATTR,"("===a&&n?(o++,"+"!=e&&">"!=e&&")"!=e&&""!=e&&"("!=e&&g('Unexpected token "(" ',t,s)):")"===a&&r&&(l++,("+"==e||">"==e||"("==e)&&g('Unexpected token ")" ',t,s)),"."===a&&n?("+"===e||">"===e||"*"===e||"("===e||")"===e)&&g("Unexpected token "+a,t,s):"#"===a&&n?("+"===e||">"===e||"*"===e||"("===e||")"===e)&&g("Unexpected token "+a,t,s):">"===a&&r?("+"==e||">"==e||")"==e||"("==e)&&g("Unexpected token >",t,s):"+"===a&&r?("+"==e||">"==e||"("==e)&&g("Unexpected token +",t,s):"["===a&&i?(("+"===e||">"===e||"*"===e||"("===e||")"===e)&&g("Unexpected token "+a,t,s),c!=T.ATTR?c=T.ATTR:g("Unexpected token [",t,s)):"="===a&&i?c==T.ATTR?(("["==e||","==e||"="==e)&&g('Unexpected token "="',t,s),0==p?p=1:g('Unexpected token "=" !maybe you lost ","',t,s)):g('"=" must in attribute definition!(eg.[name=value])',t,s):","===a&&i?c==T.ATTR?(("["==e||","==e||"="==e)&&g('Unexpected token ",".',t,s),1==p?p=0:g('Unexpected token "," maybe you lost "=".',t,s)):g('"," must in attribute definition!(eg.[n1=v1,n2=v2])',t,s):"]"===a&&i?c==T.ATTR?(","===e||"="===e?g('Unexpected token "'+e+'".',t,s):"["===e&&g("Can not define a empty attribute.",t,s),0==p&&g('Unexpected token "]" maybe a attribute is not completed.',t,s),p=0,c=-1):g('Unexpected token "]".',t,s):"*"===a&&n?("+"===e||">"===e||"*"===e||"("===e)&&g('Unexpected token "'+a+'".',t,s):"@"===a&&r?c==T.VALUE?c=-1:(">"!==e&&"+"!==e&&g('textNode @ must after ">" or "+".',t,s),c=T.VALUE):"\\"===a?u=!0:(!n||"\n"!==a&&" "!==a)&&(")"==e&&g('"+" or ">" or "*" is missing.',t,s),a="a",u=!1),s++;o!=l&&g('Unmatched "(" and ")".',t,s)}function A(t,e){var n=e-5,i=e+5;return"[index:"+e+(n>0?' at:"..':' at:"')+t.substring(n,i)+(t.length>i?'.."]':'"]')}function g(t,e,n){var i=Error(t+" "+A(e,n));throw i.name="ParseError",i.idx=n,i}for(var T={TAG_NAME:1,CLASS_NAME:2,ID:3,ATTR:4,END_ATTR:5,VALUE:7,COMPLETE:8},N="area|base|basefont|bgsound|br|col|frame|hr|img|input|isindex|link|meta|param|embed|wbr".split("|"),E={},R=0;N.length>R;R++)E[N[R]]=1;N=null;var U,v,x,k,b,y,L,H,C,M,V,_,S,w={};l.prototype={constructor:l,toHTML:function(t,n){var i="",r="",a="";if(n?r=t:a=t,"textNode"==this.type)return r+(s("tagHtmlRim",this,1)||"")+o(this.textContent,+this.iterNum)+(s("tagHtmlRim",this,-2)||"")+a;if(i=(s("tagHtmlRim",this,1)||"")+"<"+this.tagName,this.id!=e&&(i+=' id="'+this.id+'"'),this.className&&(i+=' class="'+this.className.substr(0,this.className.length-1)+'"'),this.props.length>0)for(var l=0;this.props.length>l;l++)i+=" "+this.props[l].key+'="'+this.props[l].value+'"';return i=s("tagHtmlInner",this,i)||i,this.isClosed?(i+=">",1!==E[this.tagName]&&(i+=(s("tagHtmlRim",this,2)||"")+(s("tagHtmlRim",this,-1)||"")+"</"+this.tagName+">"),i+=s("tagHtmlRim",this,-2)||"",r+o(i,this.iterNum)+a):(i+=">"+(s("tagHtmlRim",this,2)||"")+t+(s("tagHtmlRim",this,-1)||"")+"</"+this.tagName+">"+(s("tagHtmlRim",this,-2)||""),o(i,this.iterNum))}};var D=function(t){var e,n,i,r="",a="",o="";if(x=new l,k=[],_=[],L="",b=0,V=0,C=!1,M=!1,H="",y=T.TAG_NAME,0==t.length)return"";for(S=t;S.length>b;)r=S.charAt(b),e=!C&&y!==T.ATTR&&y!==T.VALUE,n=!C&&y!=T.ATTR,i=!C&&y!=T.VALUE,"."===r&&e?(u(),L="",y=T.CLASS_NAME):"#"===r&&e?(u(),L="",y=T.ID):">"===r&&n?(y==T.VALUE||1==E[x.tagName]?c(!0,H):(c(!1,H),V++),H="",L="",M=!1,y=T.TAG_NAME):"+"===r&&n?(c(!0,H),L="",H="",M=!1,y=T.TAG_NAME):"("===r&&e?(k.push("("),_.push(V)):")"===r&&n?(c(!0,H),V=_.pop(),k.push(")"),y=T.COMPLETE,L="",H="",M=!1):"["===r&&i?y!=T.ATTR&&(u(),L="",y=T.ATTR):"="===r&&i?y==T.ATTR&&(a.length>0||(a=L,L="")):","===r&&i?y==T.ATTR&&a.length>0&&(o=L,x.props.push({key:a,value:o}),a="",L=""):"]"===r&&i?y==T.ATTR&&a.length>0&&(o=L,x.props.push({key:a,value:o}),a="",L="",y=T.END_ATTR):"*"===r&&e?M=!0:"@"===r&&n?y!=T.VALUE&&(y=T.VALUE,x.type="textNode"):"\\"===r?C=!0:(!e||"\n"!==r&&" "!==r)&&(M?H+=r:L+=r,C=!1),b++;return c(!0,H),p(k),s("build",k)};return i("build",h),{parse:D,inspectSyntax:f,enableIndent:d,pushHandler:n,appendHandler:i,removeHandler:a,setHandler:r}}(window);