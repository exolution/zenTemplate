var zenTemplate=function(t,e){function n(t,n){D[t]==e?D[t]=[n]:D[t].unshift(n)}function i(t,n){D[t]==e?D[t]=[n]:D[t].push(n)}function r(t,e){D[t]=[e]}function a(t,e){var n;return D[t]?(n=D[t].indexOf(e),-1!=n?(D[t].splice(n,1),!0):!1):!1}function s(t){var e,n;if(D[t]&&(e=D[t].length)>0)for(var i=0;e>i;i++)n=D[t][i].apply(D[t],Array.prototype.slice.call(arguments,1).concat(n));return n}function o(t,e){var n,i="";if(x=x||/%([0-9]+|[a-zA-Z])%/g,0==e||isNaN(e))return t;var r=function(t,e,i,r){return U&&U.call(r,e,i+1)||isNaN(+e)?String.fromCharCode(e.charCodeAt(0)+n):+e+n+""};for(n=0;e>n;n++)i+=t.replace(x,r);return r=null,i}function l(t){this.type=t||"tag",this.className="",this.props=[]}function c(){switch(L){case T.TAG_NAME:k.tagName=H;break;case T.ID:k.id=H;break;case T.CLASS_NAME:k.className+=H+" ";break;case T.VALUE:k.textContent=H}k.tier=_}function u(t,e){L==T.COMPLETE?+e>0&&(b[b.length-1]+="*"+e):(c(),k.isClosed=t,k.iterNum=+e,b.push(k),k=new l)}function p(t){var e="";for(var n in t)e+=JSON.stringify(t[n])+"\n";console.log(e)}function h(t,e){console.log(arguments);var n,i,r="";for(e=e||0;t.length>0;)if(n=t.pop(),n instanceof l)r=n.toHTML(r),console.log(r);else if("string"==typeof n&&")"==n.charAt(0))i=h(t,+n.split("*")[1]||0),r=i+r;else if("("===n)return e>0?o(r,e):r;return e>0?o(r,e):r}function m(t,e){var n="";if(1===e||-1===e&&!t.isClosed)for(var i=0;t.tier>i;i++)n+="    ";else(-2===e||!t.isClosed&&2===e)&&(n="\n");return n}function f(t){t?r("tagHtmlRim",m):a("tagHtmlRim",m)}function d(t){for(var e,n,i,r,a="",s=0,o=0,l=0,c=!1,u=-1,p=0;t.length>s;)"\n"!=a&&" "!=a&&(e=a),a=t.charAt(s),n=!c&&u!=T.ATTR&&u!=T.VALUE,i=!c&&u!=T.VALUE,r=!c&&u!=T.ATTR,"("===a&&n?(o++,"+"!=e&&">"!=e&&")"!=e&&""!=e&&"("!=e&&A('Unexpected token "(" ',t,s)):")"===a&&r&&(l++,("+"==e||">"==e||"("==e)&&A('Unexpected token ")" ',t,s)),"."===a&&n?("+"===e||">"===e||"*"===e||"("===e||")"===e)&&A("Unexpected token "+a,t,s):"#"===a&&n?("+"===e||">"===e||"*"===e||"("===e||")"===e)&&A("Unexpected token "+a,t,s):">"===a&&r?("+"==e||">"==e||")"==e||"("==e)&&A("Unexpected token >",t,s):"+"===a&&r?("+"==e||">"==e||"("==e)&&A("Unexpected token +",t,s):"["===a&&i?(("+"===e||">"===e||"*"===e||"("===e||")"===e)&&A("Unexpected token "+a,t,s),u!=T.ATTR?u=T.ATTR:A("Unexpected token [",t,s)):"="===a&&i?u==T.ATTR?(("["==e||","==e||"="==e)&&A('Unexpected token "="',t,s),0==p?p=1:A('Unexpected token "=" !maybe you lost ","',t,s)):A('"=" must in attribute definition!(eg.[name=value])',t,s):","===a&&i?u==T.ATTR?(("["==e||","==e||"="==e)&&A('Unexpected token ",".',t,s),1==p?p=0:A('Unexpected token "," maybe you lost "=".',t,s)):A('"," must in attribute definition!(eg.[n1=v1,n2=v2])',t,s):"]"===a&&i?u==T.ATTR?(","===e||"="===e?A('Unexpected token "'+e+'".',t,s):"["===e&&A("Can not define a empty attribute.",t,s),0==p&&A('Unexpected token "]" maybe a attribute is not completed.',t,s),p=0,u=-1):A('Unexpected token "]".',t,s):"*"===a&&n?("+"===e||">"===e||"*"===e||"("===e)&&A('Unexpected token "'+a+'".',t,s):"@"===a&&r?u==T.VALUE?u=-1:(">"!==e&&"+"!==e&&A('textNode @ must after ">" or "+".',t,s),u=T.VALUE):"\\"===a?c=!0:(!n||"\n"!==a&&" "!==a)&&(")"==e&&A('"+" or ">" or "*" is missing.',t,s),a="a",c=!1),s++;o!=l&&A('Unmatched "(" and ")".',t,s)}function g(t,e){var n=e-5,i=e+5;return"[index:"+e+(n>0?' at:"..':' at:"')+t.substring(n,i)+(t.length>i?'.."]':'"]')}function A(t,e,n){var i=Error(t+" "+g(e,n));throw i.name="ParseError",i.idx=n,i}var T={TAG_NAME:1,CLASS_NAME:2,ID:3,ATTR:4,END_ATTR:5,VALUE:7,COMPLETE:8};try{console.log("zenTemplate v0.5!")}catch(N){console={log:function(){}}}for(var v="area|base|basefont|bgsound|br|col|frame|hr|img|input|isindex|link|meta|param|embed|wbr".split("|"),E={},R=0;v.length>R;R++)E[v[R]]=1;v=null;var U,x,k,b,y,L,H,C,M,V,_,S,w,D={};l.prototype={constructor:l,toHTML:function(t,n){var i="",r="",a="";if(n?r=t:a=t,"textNode"==this.type)return r+(s("tagHtmlRim",this,1)||"")+o(this.textContent,+this.iterNum)+(s("tagHtmlRim",this,-2)||"")+a;if(i=(s("tagHtmlRim",this,1)||"")+"<"+this.tagName,this.id!=e&&(i+=' id="'+this.id+'"'),this.className&&(i+=' class="'+this.className.substr(0,this.className.length-1)+'"'),this.props.length>0)for(var l=0;this.props.length>l;l++)i+=" "+this.props[l].key+'="'+this.props[l].value+'"';return i=s("tagHtmlInner",this,i)||i,this.isClosed?(i+=">",1!==E[this.tagName]&&(i+=(s("tagHtmlRim",this,2)||"")+(s("tagHtmlRim",this,-1)||"")+"</"+this.tagName+">"),i+=s("tagHtmlRim",this,-2)||"",r+o(i,this.iterNum)+a):(i+=">"+(s("tagHtmlRim",this,2)||"")+t+(s("tagHtmlRim",this,-1)||"")+"</"+this.tagName+">"+(s("tagHtmlRim",this,-2)||""),o(i,this.iterNum))}};var G=function(t){var e,n,i,r="",a="",o="";if(k=new l,b=[],S=[],H="",y=0,_=0,M=!1,V=!1,C="",L=T.TAG_NAME,0==t.length)return"";for(w=t;w.length>y;)r=w.charAt(y),e=!M&&L!==T.ATTR&&L!==T.VALUE,n=!M&&L!=T.ATTR,i=!M&&L!=T.VALUE,"."===r&&e?(c(),H="",L=T.CLASS_NAME):"#"===r&&e?(c(),H="",L=T.ID):">"===r&&n?(L==T.VALUE||1==E[k.tagName]?u(!0,C):(u(!1,C),_++),C="",H="",V=!1,L=T.TAG_NAME):"+"===r&&n?(u(!0,C),H="",C="",V=!1,L=T.TAG_NAME):"("===r&&e?(b.push("("),S.push(_)):")"===r&&n?(u(!0,C),_=S.pop(),b.push(")"),L=T.COMPLETE,H="",C="",V=!1):"["===r&&i?L!=T.ATTR&&(c(),H="",L=T.ATTR):"="===r&&i?L==T.ATTR&&(a.length>0||(a=H,H="")):","===r&&i?L==T.ATTR&&a.length>0&&(o=H,k.props.push({key:a,value:o}),a="",H=""):"]"===r&&i?L==T.ATTR&&a.length>0&&(o=H,k.props.push({key:a,value:o}),a="",H="",L=T.END_ATTR):"*"===r&&e?V=!0:"@"===r&&n?L!=T.VALUE&&(L=T.VALUE,k.type="textNode"):"\\"===r?M=!0:(!e||"\n"!==r&&" "!==r)&&(V?C+=r:H+=r,M=!1),y++;return u(!0,C),p(b),s("build",b)};return i("build",h),{parse:G,inspectSyntax:d,enableIndent:f,pushHandler:n,appendHandler:i,removeHandler:a,setHandler:r}}(window);